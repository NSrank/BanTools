# BanTools - Velocity å°ç¦ç®¡ç†æ’ä»¶

![Velocity](https://img.shields.io/badge/Velocity-3.x-blue) ![Java](https://img.shields.io/badge/Java-17-green) ![License](https://img.shields.io/badge/License-GPLv3-green.svg)

**BanTools** æ˜¯ä¸€ä¸ªä¸“ä¸º Minecraft Velocity æœåŠ¡ç«¯è®¾è®¡çš„é«˜çº§å°ç¦ç®¡ç†æ’ä»¶ã€‚å®ƒæ”¯æŒé€šè¿‡ UUIDã€IP åœ°å€æˆ–ç”¨æˆ·åå°ç¦ç©å®¶ï¼Œå¹¶æä¾›åŠ¨æ€é…ç½®é‡è½½å’Œå®æ—¶è¸¢å‡ºåœ¨çº¿ç©å®¶çš„åŠŸèƒ½ã€‚

> **æ³¨æ„**ï¼šæœ¬æ’ä»¶ç”± AI å¼€å‘ï¼Œæ—¨åœ¨å¸®åŠ©æœåŠ¡å™¨ç®¡ç†å‘˜æ›´é«˜æ•ˆåœ°ç®¡ç†ç©å®¶å°ç¦è¡Œä¸ºã€‚

---

## åŠŸèƒ½ç‰¹æ€§

- **å°ç¦åŠŸèƒ½**ï¼š
    - æ”¯æŒæŒ‰ UUIDã€IP åœ°å€æˆ–ç©å®¶åå°ç¦ã€‚
    - é»˜è®¤å°ç¦æ—¶é—´ä¸ºæ°¸ä¹…ï¼ˆå¦‚æœæœªæŒ‡å®šæ—¶é—´ï¼‰ã€‚
    - æ”¯æŒæŒ‡å®šå°ç¦æ—¶é•¿ï¼ˆå¦‚ `7d` è¡¨ç¤º 7 å¤©ï¼Œ`2024/1/10-2025/01/10` è¡¨ç¤ºè‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ï¼‰ã€‚
    - è‡ªåŠ¨è¸¢å‡ºè¢«å°ç¦çš„åœ¨çº¿ç©å®¶ã€‚
- **è§£å°åŠŸèƒ½**ï¼š
    - æ”¯æŒé€šè¿‡ `/bantools unban` å‘½ä»¤è§£é™¤æŒ‡å®šç©å®¶çš„å°ç¦çŠ¶æ€ã€‚
    - è§£å°åä¸ä¼šåˆ é™¤å°ç¦è®°å½•ï¼Œè€Œæ˜¯å°†å°ç¦çŠ¶æ€æ ‡è®°ä¸ºæ— æ•ˆã€‚
- **è¸¢å‡ºåŠŸèƒ½**ï¼š
    - æ”¯æŒé€šè¿‡ `/bantools kick` å‘½ä»¤ç«‹å³è¸¢å‡ºæŒ‡å®šç©å®¶ã€‚
    - å¯ä»¥æŒ‡å®šè¸¢å‡ºåŸå› ï¼ˆé»˜è®¤ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤è¸¢å‡ºåŸå› ï¼‰ã€‚
- **é‡å¤å°ç¦æ£€æŸ¥**ï¼š
    - è‡ªåŠ¨æ£€æŸ¥ç©å®¶æ˜¯å¦å·²è¢«å°ç¦ï¼Œé˜²æ­¢é‡å¤å°ç¦æ“ä½œã€‚
    - æ˜¾ç¤ºç°æœ‰å°ç¦çš„è¯¦ç»†ä¿¡æ¯ï¼ˆç†ç”±å’Œæ—¶é•¿ï¼‰ã€‚
- **é‡å¤è§£å°æ£€æŸ¥**ï¼š
    - è‡ªåŠ¨æ£€æŸ¥ç©å®¶æ˜¯å¦å·²è¢«è§£å°æˆ–æœªè¢«å°ç¦ï¼Œé˜²æ­¢é‡å¤è§£å°æ“ä½œã€‚
    - æä¾›æ¸…æ™°çš„çŠ¶æ€æç¤ºä¿¡æ¯ã€‚
- **è‡ªåŠ¨è§£å°æœºåˆ¶**ï¼š
    - å¦‚æœæŒ‡å®šäº†å°ç¦æ—¶é•¿ï¼Œåˆ°è¾¾å°ç¦ç»“æŸæ—¶é—´åä¼šè‡ªåŠ¨è§£é™¤å°ç¦ã€‚
- **å¤šæ¡ä»¶åŒ¹é…**ï¼š
    - ç™»å½•æ—¶ä¼šåŒæ—¶æ£€æŸ¥ UUIDã€IP åœ°å€å’Œç©å®¶åæ˜¯å¦åŒ¹é…å°ç¦è®°å½•ã€‚
    - å¦‚æœä»»æ„ä¸€é¡¹åŒ¹é…ï¼Œåˆ™è§†ä¸ºè¢«å°ç¦ã€‚
- **é…ç½®æ–‡ä»¶æ”¯æŒ**ï¼š
    - æ‰€æœ‰å°ç¦è®°å½•å­˜å‚¨åœ¨ `config.conf` æ–‡ä»¶ä¸­ï¼Œæ”¯æŒæ‰‹åŠ¨ç¼–è¾‘ã€‚
    - é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®é»˜è®¤å°ç¦åŸå› å’Œè¸¢å‡ºåŸå› ã€‚
- **åŠ¨æ€é…ç½®é‡è½½**ï¼š
    - æ”¯æŒé€šè¿‡ `/bantools reload` å‘½ä»¤åŠ¨æ€é‡è½½é…ç½®æ–‡ä»¶ï¼Œæ— éœ€é‡å¯æœåŠ¡å™¨ã€‚
- **å®æ—¶åŒæ­¥**ï¼š
    - æ‰€æœ‰å°ç¦ã€è§£å°å’Œè¸¢å‡ºæ“ä½œä¼šå®æ—¶åŒæ­¥åˆ°æ‰€æœ‰ä¸‹æ¸¸æœåŠ¡å™¨ã€‚

---

## å®‰è£…æ­¥éª¤

### 1. ä¸‹è½½æ’ä»¶
ä» [GitHub](https://github.com/NSrank/BanTools) æˆ–å…¶ä»–åˆ†å‘æ¸ é“ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ `BanTools.jar`ã€‚

### 2. å®‰è£…æ’ä»¶
å°†ä¸‹è½½çš„ `BanTools.jar` æ–‡ä»¶æ”¾å…¥ Velocity æœåŠ¡ç«¯çš„ `plugins/` ç›®å½•ä¸­ã€‚

### 3. å¯åŠ¨æœåŠ¡å™¨
å¯åŠ¨ Velocity æœåŠ¡ç«¯ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ `plugins/BanTools/config.conf`ã€‚

## é…ç½®æ–‡ä»¶ï¼ˆ`config.conf`ï¼‰
```
defaults {
  ban_reason = "è¿åæœåŠ¡å™¨è§„åˆ™"
  kick_reason = "ç®¡ç†å‘˜å¼ºåˆ¶è¸¢å‡º"
}

bans {
  "OnlinePlayer": {
    name: "OnlinePlayer"
    uuid: "069a79f4-44e9-4726-a5be-fca90e38aaf5"
    ip: "192.168.1.100"
    reason: "ä½œå¼Šè¡Œä¸º"
    start_time: 1698765432
    end_time: null  # æ°¸ä¹…å°ç¦
    state: true     # å°ç¦çŠ¶æ€ï¼ˆtrueï¼šç”Ÿæ•ˆï¼Œfalseï¼šè§£é™¤ï¼‰
  }
  "OfflinePlayer": {
    name: "OfflinePlayer"
    uuid: null      # ç¦»çº¿å°ç¦ï¼Œç™»å½•æ—¶è‡ªåŠ¨æ›´æ–°
    ip: null        # ç¦»çº¿å°ç¦ï¼Œç™»å½•æ—¶è‡ªåŠ¨æ›´æ–°
    reason: "è¿åæœåŠ¡å™¨è§„åˆ™"
    start_time: 1698765432
    end_time: null  # æ°¸ä¹…å°ç¦
    state: true     # å°ç¦çŠ¶æ€ï¼ˆtrueï¼šç”Ÿæ•ˆï¼Œfalseï¼šè§£é™¤ï¼‰
  }
}
```
- `defaults.ban_reason`ï¼šé»˜è®¤å°ç¦åŸå› ã€‚
- `defaults.kick_reason`ï¼šé»˜è®¤è¸¢å‡ºåŸå› ã€‚
- `bans`ï¼šå­˜å‚¨æ‰€æœ‰å°ç¦è®°å½•ï¼Œæ¯ä¸ªæ¡ç›®åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
  - `name`ï¼šç©å®¶åã€‚
  - `uuid`ï¼šç©å®¶ UUIDã€‚
  - `ip`ï¼šç©å®¶ IP åœ°å€ã€‚
  - `reason`ï¼šå°ç¦åŸå› ã€‚
  - `start_time`ï¼šå°ç¦å¼€å§‹æ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰ã€‚
  - `end_time`ï¼šå°ç¦ç»“æŸæ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰ï¼Œå¦‚æœä¸º `null` è¡¨ç¤ºæ°¸ä¹…å°ç¦ã€‚
  - `state`ï¼šå°ç¦çŠ¶æ€ï¼ˆ`true` è¡¨ç¤ºç”Ÿæ•ˆï¼Œ`false` è¡¨ç¤ºè§£é™¤ï¼‰ã€‚

---

## ğŸ”§ ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### v1.3.2 (æœ€æ–°ç‰ˆæœ¬)
**é‡è¦æ”¹è¿›ï¼š**
- âœ… **è§£å°å‘½ä»¤é‡æ„**ï¼šå°†ç‹¬ç«‹çš„ `/unban` å‘½ä»¤æ•´åˆåˆ° `/bantools unban` æˆ– `/bt unban` ä¸­ï¼Œé¿å…ä¸å…¶ä»–æ’ä»¶å†²çª
- âœ… **ä¿®å¤æ•°æ®åŒæ­¥é—®é¢˜**ï¼šå°ç¦å’Œè§£å°æ“ä½œåè‡ªåŠ¨åˆ·æ–°å†…å­˜æ•°æ®ï¼Œæ— éœ€é‡å¯æœåŠ¡å™¨
- âœ… **é˜²é‡å¤å°ç¦åŠŸèƒ½**ï¼šè‡ªåŠ¨æ£€æŸ¥ç°æœ‰å°ç¦è®°å½•ï¼Œé˜²æ­¢é‡å¤å°ç¦æ“ä½œ
- âœ… **é‡å¤è§£å°æ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æŸ¥ç©å®¶è§£å°çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤è§£å°æ“ä½œ
- âœ… **ç»Ÿä¸€å‘½ä»¤ä½“ç³»**ï¼šæ‰€æœ‰å‘½ä»¤ç°åœ¨éƒ½ä½¿ç”¨ç»Ÿä¸€çš„ `/bantools` æˆ– `/bt` å‰ç¼€
- âœ… **æ™ºèƒ½çŠ¶æ€æ£€æµ‹**ï¼šåŒºåˆ†"å·²è§£å°"ã€"æœªå°ç¦"å’Œ"æ— è®°å½•"ä¸‰ç§çŠ¶æ€

**æ–°å¢åŠŸèƒ½ï¼š**
- ğŸ†• **é‡å¤å°ç¦æ£€æŸ¥**ï¼šå°ç¦å‰è‡ªåŠ¨æ£€æŸ¥ç©å®¶æ˜¯å¦å·²è¢«å°ç¦
- ğŸ†• **è¯¦ç»†å°ç¦ä¿¡æ¯æç¤º**ï¼šæ˜¾ç¤ºç°æœ‰å°ç¦çš„ç†ç”±å’Œæ—¶é•¿
- ğŸ†• **å®æ—¶æ•°æ®åŒæ­¥**ï¼šæ‰€æœ‰å°ç¦æ“ä½œç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
- ğŸ†• **è§£å°çŠ¶æ€éªŒè¯**ï¼šè§£å°å‰æ£€æŸ¥ç©å®¶å½“å‰å°ç¦çŠ¶æ€
- ğŸ†• **è¯¦ç»†çŠ¶æ€æç¤º**ï¼šæä¾›æ¸…æ™°çš„è§£å°ç»“æœåé¦ˆ
- ğŸ†• **æƒé™åˆ†ç¦»ä¼˜åŒ–**ï¼šunbanæ“ä½œä½¿ç”¨ç‹¬ç«‹çš„æƒé™èŠ‚ç‚¹

**ç”¨æˆ·ä½“éªŒæ”¹è¿›ï¼š**
- å‘½ä»¤å†²çªé£é™©é™ä½ï¼šé¿å…ä¸å…¶ä»–æ’ä»¶çš„ `/unban` å‘½ä»¤å†²çª
- æ“ä½œåé¦ˆæ›´æ¸…æ™°ï¼šæ˜ç¡®åŒºåˆ†ä¸åŒçš„è§£å°å¤±è´¥åŸå› 
- å‘½ä»¤ä½“ç³»æ›´ç»Ÿä¸€ï¼šæ‰€æœ‰åŠŸèƒ½éƒ½åœ¨ä¸€ä¸ªå‘½ä»¤ä¸‹ç®¡ç†

**æŠ€æœ¯æ”¹è¿›ï¼š**
- ä¼˜åŒ–äº†å†…å­˜æ•°æ®åŒæ­¥æœºåˆ¶

### v1.3.1
**é‡è¦ä¿®å¤ï¼š**
- âœ… **ä¿®å¤é…ç½®æ–‡ä»¶æ‰å¹³åŒ–é—®é¢˜**ï¼šè§£å†³äº†ç¦»çº¿ç©å®¶å°ç¦åé‡å¯æœåŠ¡å™¨å‡ºç°çš„é…ç½®åŠ è½½é”™è¯¯
- âœ… **æ™ºèƒ½é…ç½®ä¿®å¤**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤æŸåçš„é…ç½®æ–‡ä»¶æ ¼å¼
- âœ… **æ”¹è¿›é”™è¯¯å¤„ç†**ï¼šæ›´å¥½çš„é…ç½®æ–‡ä»¶è§£æå’Œé”™è¯¯æ¢å¤æœºåˆ¶
- âœ… **å®‰å…¨å¤‡ä»½æœºåˆ¶**ï¼šæŸåçš„é…ç½®æ–‡ä»¶ä¼šè‡ªåŠ¨å¤‡ä»½ï¼Œé¿å…æ•°æ®ä¸¢å¤±

**æŠ€æœ¯æ”¹è¿›ï¼š**
- å®ç°äº†æ‰å¹³åŒ–é…ç½®æ£€æµ‹ç®—æ³•
- æ·»åŠ äº†è‡ªåŠ¨é…ç½®é‡å»ºåŠŸèƒ½
- æ”¹è¿›äº†é…ç½®æ–‡ä»¶ä¿å­˜æ ¼å¼
- å¢å¼ºäº†ç¦»çº¿ç©å®¶å¤„ç†é€»è¾‘
- ä¼˜åŒ–äº†å†…å­˜æ•°æ®åŒæ­¥æœºåˆ¶

### v1.3.0
- ä¿®å¤äº†æƒé™æ£€æŸ¥æ¼æ´
- æ”¹è¿›äº†ç¦»çº¿ç©å®¶å°ç¦å¤„ç†
- æ·»åŠ äº†è¾“å…¥éªŒè¯å’Œå®‰å…¨æ£€æŸ¥
- æ›´æ–°äº†READMEæ–‡æ¡£

---

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤                                    | åˆ«å  | æƒé™èŠ‚ç‚¹                      | æè¿°            |
|---------------------------------------|-----|---------------------------|---------------|
| `/bantools reload`                    | `/bt reload` | `bantools.command.reload` | é‡æ–°åŠ è½½æ’ä»¶é…ç½®æ–‡ä»¶ã€‚   |
| `/bantools ban <ç©å®¶> [åŸå› ] [æ—¶é•¿]`      | `/bt ban <ç©å®¶> [åŸå› ] [æ—¶é•¿]` | `bantools.command.ban`    | å°ç¦æŒ‡å®šç©å®¶ã€‚       |
| `/bantools unban <ç©å®¶>`              | `/bt unban <ç©å®¶>` | `bantools.command.unban`  | è§£é™¤æŒ‡å®šç©å®¶çš„å°ç¦çŠ¶æ€ã€‚  |
| `/bantools kick <ç©å®¶> [åŸå› ]`          | `/bt kick <ç©å®¶> [åŸå› ]` | `bantools.command.kick`   | è¸¢å‡ºæŒ‡å®šç©å®¶ã€‚       |

### ç¤ºä¾‹
1. å°ç¦ç”¨æˆ·åä¸º `Bianpao_xiaohai` çš„ç©å®¶ï¼š`/bantools ban Bianpao_xiaohai` æˆ– `/bt ban Bianpao_xiaohai`
2. å°ç¦ç©å®¶å¹¶æŒ‡å®šåŸå› ï¼š`/bt ban Steve æ¶æ„ç ´å`
3. å°ç¦ç©å®¶å¹¶æŒ‡å®šæ—¶é•¿ï¼š`/bt ban Steve ä½œå¼Šè¡Œä¸º 7d`ï¼ˆ7å¤©åè‡ªåŠ¨è§£å°ï¼‰
4. å°è¯•é‡å¤å°ç¦å·²å°ç¦çš„ç©å®¶ï¼š`/bt ban Steve å†æ¬¡ä½œå¼Š`
   - ç³»ç»Ÿæç¤ºï¼š`è¯¥ç©å®¶å·²è¢«å°ç¦ï¼ç†ç”±ï¼šä½œå¼Šè¡Œä¸ºï¼Œæ—¶é•¿ï¼šè‡³ 2024/01/17`
5. è§£å°ç”¨æˆ·åä¸º `Steve` çš„ç©å®¶ï¼š`/bt unban Steve`
6. å°è¯•é‡å¤è§£å°å·²è§£å°çš„ç©å®¶ï¼š`/bt unban Steve`
   - ç³»ç»Ÿæç¤ºï¼š`è¯¥ç©å®¶æœªè¢«å°ç¦æˆ–å·²è¢«è§£å°ï¼`
7. è¸¢å‡ºç”¨æˆ·åä¸º `Steve` çš„ç©å®¶ï¼š`/bt kick Steve è¿åè§„åˆ™`

---

## âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### å®‰å…¨å»ºè®®
- è°¨æ…åˆ†é… `bantools.command.kick` å’Œ `bantools.command.ban` æƒé™
- å®šæœŸæ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„å°ç¦è®°å½•æ˜¯å¦æ­£ç¡®åŠ è½½
- å»ºè®®ç»“åˆå…¶ä»–å®‰å…¨æ’ä»¶ä½¿ç”¨ï¼Œå¦‚ IP ç™½åå•ã€åä½œå¼Šæ’ä»¶ç­‰
- åœ¨é‡è¦æœåŠ¡å™¨ä¸Šä½¿ç”¨å‰è¯·å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åŠŸèƒ½

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: é‡å¯æœåŠ¡å™¨åå‡ºç° "Invalid data type for player 'xxx.state'" é”™è¯¯**
A: è¿™æ˜¯é…ç½®æ–‡ä»¶æ‰å¹³åŒ–é—®é¢˜ï¼Œv1.3.1å·²è‡ªåŠ¨ä¿®å¤ã€‚æ’ä»¶ä¼šæ˜¾ç¤º"æ£€æµ‹åˆ°æ‰å¹³åŒ–çš„é…ç½®æ–‡ä»¶ï¼Œå°è¯•ä¿®å¤..."å¹¶è‡ªåŠ¨é‡å»ºé…ç½®ã€‚

**Q: å°ç¦çš„ç¦»çº¿ç©å®¶æ— æ³•æ­£ç¡®åŠ è½½**
A: ç¡®ä¿ä½¿ç”¨v1.3.1æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å·²ä¿®å¤ç¦»çº¿ç©å®¶å¤„ç†é€»è¾‘ã€‚

**Q: é…ç½®æ–‡ä»¶æŸåæ€ä¹ˆåŠ**
A: æ’ä»¶ä¼šè‡ªåŠ¨å¤‡ä»½æŸåçš„é…ç½®æ–‡ä»¶ï¼ˆæ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³ï¼‰ï¼Œç„¶åé‡æ–°åˆ›å»ºé»˜è®¤é…ç½®ã€‚

**Q: æƒé™è®¾ç½®é—®é¢˜**
A: ç¡®ä¿æ­£ç¡®åˆ†é…æƒé™ï¼š
- `bantools.command.ban` - å°ç¦æƒé™
- `bantools.command.kick` - è¸¢å‡ºæƒé™
- `bantools.command.unban` - è§£å°æƒé™
- `bantools.command.reload` - é‡è½½æƒé™

**Q: è§£å°å‘½ä»¤ä¸å·¥ä½œæˆ–ä¸å…¶ä»–æ’ä»¶å†²çª**
A: v1.3.2å·²å°†è§£å°å‘½ä»¤æ•´åˆåˆ° `/bt unban` ä¸­ï¼Œä¸å†ä½¿ç”¨ç‹¬ç«‹çš„ `/unban` å‘½ä»¤ï¼Œé¿å…äº†æ’ä»¶å†²çªã€‚

**Q: æç¤º"è¯¥ç©å®¶æœªè¢«å°ç¦æˆ–å·²è¢«è§£å°"**
A: è¿™è¡¨ç¤ºç©å®¶å½“å‰æ²¡æœ‰æœ‰æ•ˆçš„å°ç¦è®°å½•ï¼Œå¯èƒ½å·²ç»è¢«è§£å°æˆ–ä»æœªè¢«å°ç¦ã€‚

### é…ç½®æ–‡ä»¶æ ¼å¼

æ­£ç¡®çš„é…ç½®æ–‡ä»¶æ ¼å¼åº”è¯¥æ˜¯ï¼š
```hocon
defaults {
  ban_reason = "è¿åæœåŠ¡å™¨è§„åˆ™"
  kick_reason = "ç®¡ç†å‘˜å¼ºåˆ¶è¸¢å‡º"
}

bans {
  "PlayerName": {
    name: "PlayerName"
    uuid: "player-uuid-here"  # åœ¨çº¿å°ç¦æ—¶è‡ªåŠ¨å¡«å……
    ip: "player-ip-here"      # åœ¨çº¿å°ç¦æ—¶è‡ªåŠ¨å¡«å……
    reason: "å°ç¦åŸå› "
    start_time: 1698765432
    end_time: null            # nullè¡¨ç¤ºæ°¸ä¹…å°ç¦
    state: true               # trueè¡¨ç¤ºç”Ÿæ•ˆ
  }
  "OfflinePlayer": {
    name: "OfflinePlayer"
    uuid: null                # ç¦»çº¿å°ç¦ï¼Œç™»å½•æ—¶è‡ªåŠ¨æ›´æ–°
    ip: null                  # ç¦»çº¿å°ç¦ï¼Œç™»å½•æ—¶è‡ªåŠ¨æ›´æ–°
    reason: "ç¦»çº¿å°ç¦"
    start_time: 1698765432
    end_time: null
    state: true
  }
}
```

---

### æŠ€æœ¯æ”¯æŒä¸åé¦ˆ
å¦‚æœæ‚¨åœ¨ä½¿ç”¨æ’ä»¶è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæˆ–å¸Œæœ›æå‡ºæ”¹è¿›å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ï¼š

- **GitHub Issues** : [æäº¤é—®é¢˜](https://github.com/NSrank/BanTools/issues)

---

### ç‰ˆæƒå£°æ˜
- å¼€å‘å£°æ˜ ï¼šæœ¬æ’ä»¶ç”± AI å¼€å‘ï¼Œæ—¨åœ¨ä¸º Minecraft Velocity ç¤¾åŒºæä¾›é«˜æ•ˆçš„å°ç¦ç®¡ç†å·¥å…·ã€‚
- è®¸å¯è¯ ï¼šæœ¬æ’ä»¶éµå¾ª GNU General Public License v3.0 è®¸å¯è¯ï¼Œæ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ï¼Œä½†éœ€éµå®ˆè®¸å¯è¯æ¡æ¬¾ã€‚
- å…è´£æ¡æ¬¾ ï¼šå¼€å‘è€…ä¸å¯¹å› ä½¿ç”¨æœ¬æ’ä»¶è€Œå¯¼è‡´çš„ä»»ä½•é—®é¢˜è´Ÿè´£ã€‚

---

### ç‰¹åˆ«æ„Ÿè°¢
æ„Ÿè°¢ä»¥ä¸‹æŠ€æœ¯å’Œå·¥å…·å¯¹æœ¬æ’ä»¶çš„æ”¯æŒï¼š

- [Velocity API](https://papermc.io/software/velocity)
- [Typesafe Config](https://github.com/lightbend/config?spm=a2ty_o01.29997173.0.0.7c5733f51H3mj8)
- [Adventure API](https://github.com/KyoriPowered/adventure?spm=a2ty_o01.29997173.0.0.7c5733f51H3mj8)

---

# BanTools - Velocity Ban Management Plugin

![Velocity](https://img.shields.io/badge/Velocity-3.x-blue) ![Java](https://img.shields.io/badge/Java-17-green) ![License](https://img.shields.io/badge/License-GPLv3-green.svg)

**BanTools** is an advanced ban management plugin designed for Minecraft Velocity servers. It supports banning players by UUID, IP address, or username, and provides dynamic configuration reloading and real-time kicking of online players.

> **Note**: This plugin is AI-developed to help server administrators manage player bans more efficiently.

---

## Features

- **Ban Functionality**:
    - Supports banning by UUID, IP address, or player name.
    - Default ban duration is permanent (if no duration is specified).
    - Supports specifying ban duration (e.g., `7d` for 7 days, `2024/1/10-2025/01/10` for a custom date range).
    - Automatically kicks banned online players.
- **Unban Functionality**:
    - Supports unbanning a player using the `/bantools unban` command.
    - Unbanning does not delete the ban record but marks the ban status as invalid.
- **Kick Functionality**:
    - Supports immediately kicking a player using the `/bantools kick` command.
    - A custom kick reason can be specified (default uses the configured reason in the config file).
- **Duplicate Ban Prevention**:
    - Automatically checks if a player is already banned to prevent duplicate ban operations.
    - Displays detailed information about existing bans (reason and duration).
- **Duplicate Unban Prevention**:
    - Automatically checks if a player is already unbanned or not banned to prevent duplicate unban operations.
    - Provides clear status notification messages.
- **Automatic Unban Mechanism**:
    - If a ban duration is specified, the ban will automatically expire when the time ends.
- **Multi-Condition Matching**:
    - On login, checks if UUID, IP address, or player name matches any ban records.
    - If any condition matches, the player is considered banned.
- **Configuration File Support**:
    - All ban records are stored in the `config.conf` file, which supports manual editing.
    - The configuration file allows setting default ban and kick reasons.
- **Dynamic Configuration Reload**:
    - Supports dynamically reloading the configuration file via the `/bantools reload` command without restarting the server.
- **Real-Time Synchronization**:
    - All ban, unban, and kick operations are synchronized in real-time across all downstream servers.

---

## Installation

### 1. Download the Plugin
Download the latest version of `BanTools.jar` from [GitHub](https://github.com/NSrank/BanTools) or other distribution channels.

### 2. Install the Plugin
Place the downloaded `BanTools.jar` file into the `plugins/` directory of your Velocity server.

### 3. Start the Server
Start the Velocity server. The plugin will automatically generate a default configuration file at `plugins/BanTools/config.conf`.

## Configurationï¼ˆ`config.conf`ï¼‰
```
defaults {
  ban_reason = "è¿åæœåŠ¡å™¨è§„åˆ™"
  kick_reason = "ç®¡ç†å‘˜å¼ºåˆ¶è¸¢å‡º"
}

bans {
  "OnlinePlayer": {
    name: "OnlinePlayer"
    uuid: "069a79f4-44e9-4726-a5be-fca90e38aaf5"
    ip: "192.168.1.100"
    reason: "Cheating"
    start_time: 1698765432
    end_time: null  # Permanent ban
    state: true     # Ban status (true: active, false: unbanned)
  }
  "OfflinePlayer": {
    name: "OfflinePlayer"
    uuid: null      # Offline ban, auto-updated on login
    ip: null        # Offline ban, auto-updated on login
    reason: "Rule violation"
    start_time: 1698765432
    end_time: null  # Permanent ban
    state: true     # Ban status (true: active, false: unbanned)
  }
}
```
- `defaults.ban_reason`: Default ban reason.
- `defaults.kick_reason`: Default kick reason.
- `bans`: Stores all ban records, each entry contains the following fields:
  - `name`: Player name.
  - `uuid`: Player UUID.
  - `ip`: Player IP address.
  - `reason`: Ban reason.
  - `start_time`: Ban start time (Unix timestamp).
  - `end_time`: Ban end time (Unix timestamp), set to `null` for permanent bans.
  - `state`: Ban status (true for active, false for unban).

---

## ğŸ”§ Version Changelog

### v1.3.2 (Latest)
**Major Improvements:**
- âœ… **Unban Command Refactoring**: Integrated standalone `/unban` command into `/bantools unban` or `/bt unban` to avoid conflicts with other plugins
- âœ… **Fixed data synchronization**: Ban and unban operations now automatically refresh memory data without server restart
- âœ… **Duplicate ban prevention**: Automatically checks existing ban records to prevent duplicate ban operations
- âœ… **Duplicate Unban Prevention**: Automatically checks player unban status to prevent duplicate unban operations
- âœ… **Unified Command System**: All commands now use unified `/bantools` or `/bt` prefix
- âœ… **Smart Status Detection**: Distinguishes between "already unbanned", "not banned", and "no record" states

**New Features:**
- ğŸ†• **Duplicate ban checking**: Automatically checks if player is already banned before banning
- ğŸ†• **Detailed ban info display**: Shows existing ban reason and duration
- ğŸ†• **Real-time data sync**: All ban operations take effect immediately without restart
- ğŸ†• **Unban Status Validation**: Checks player's current ban status before unbanning
- ğŸ†• **Detailed Status Feedback**: Provides clear unban result notifications
- ğŸ†• **Optimized Permission Separation**: Unban operations use independent permission nodes

**User Experience Improvements:**
- Reduced command conflict risk: Avoids conflicts with other plugins' `/unban` commands
- Clearer operation feedback: Clearly distinguishes different unban failure reasons
- More unified command system: All features managed under one command

**Technical Improvements:**
- Optimized memory data synchronization mechanism

### v1.3.1
**Critical Fixes:**
- âœ… **Fixed config file flattening issue**: Resolved configuration loading errors after restarting server with offline player bans
- âœ… **Smart config repair**: Automatically detects and repairs corrupted configuration file formats
- âœ… **Improved error handling**: Better configuration file parsing and error recovery mechanisms
- âœ… **Safe backup mechanism**: Corrupted config files are automatically backed up to prevent data loss

**Technical Improvements:**
- Implemented flattened configuration detection algorithm
- Added automatic configuration rebuilding functionality
- Improved configuration file save format
- Enhanced offline player handling logic

### v1.3.0
- Fixed permission check vulnerabilities
- Improved offline player ban handling
- Added input validation and security checks
- Updated README documentation

---

## Usage

### Commands

| Command                                    | Alias  | Permission Node               | Description                          |
|--------------------------------------------|--------|-------------------------------|--------------------------------------|
| `/bantools reload`                         | `/bt reload` | `bantools.command.reload`     | Reloads the plugin configuration file. |
| `/bantools ban <player> [reason] [duration]` | `/bt ban <player> [reason] [duration]` | `bantools.command.ban`        | Bans the specified player.           |
| `/bantools unban <player>`                | `/bt unban <player>` | `bantools.command.unban`      | Unbans the specified player.         |
| `/bantools kick <player> [reason]`        | `/bt kick <player> [reason]` | `bantools.command.kick`       | Kicks the specified player.          |

### Examples
1. Ban a player named `Bianpao_xiaohai`: `/bantools ban Bianpao_xiaohai` or `/bt ban Bianpao_xiaohai`
2. Ban a player with reason: `/bt ban Steve Malicious behavior`
3. Ban a player with duration: `/bt ban Steve Cheating 7d` (auto-unban after 7 days)
4. Try to ban an already banned player: `/bt ban Steve Cheating again`
   - System response: `è¯¥ç©å®¶å·²è¢«å°ç¦ï¼ç†ç”±ï¼šCheatingï¼Œæ—¶é•¿ï¼šè‡³ 2024/01/17`
5. Unban a player named `Steve`: `/bt unban Steve`
6. Try to unban an already unbanned player: `/bt unban Steve`
   - System response: `è¯¥ç©å®¶æœªè¢«å°ç¦æˆ–å·²è¢«è§£å°ï¼`
7. Kick a player named `Steve`: `/bt kick Steve Rule violation`

---

## Security Considerations

### Security Recommendations

- Exercise caution when granting `bantools.command.kick` and `bantools.command.ban` permissions
- Regularly check if the ban records in the configuration file are correctly loaded
- Consider using additional security plugins such as IP whitelists and anti-cheat plugins
- Test the plugin thoroughly in a non-production environment before deployment

---

## ğŸ› ï¸ Troubleshooting

### Common Issues

**Q: Getting "Invalid data type for player 'xxx.state'" errors after server restart**
A: This is a config file flattening issue, automatically fixed in v1.3.1. The plugin will show "æ£€æµ‹åˆ°æ‰å¹³åŒ–çš„é…ç½®æ–‡ä»¶ï¼Œå°è¯•ä¿®å¤..." and automatically rebuild the configuration.

**Q: Offline banned players not loading correctly**
A: Ensure you're using v1.3.1 or higher, which has fixed offline player handling logic.

**Q: What if my config file gets corrupted**
A: The plugin automatically backs up corrupted config files (filename includes timestamp) and recreates default configuration.

**Q: Permission setup issues**
A: Ensure correct permission assignment:
- `bantools.command.ban` - Ban permission
- `bantools.command.kick` - Kick permission
- `bantools.command.unban` - Unban permission
- `bantools.command.reload` - Reload permission

**Q: Unban command not working or conflicts with other plugins**
A: v1.3.2 has integrated the unban command into `/bt unban`, no longer using the standalone `/unban` command, avoiding plugin conflicts.

**Q: Getting "è¯¥ç©å®¶æœªè¢«å°ç¦æˆ–å·²è¢«è§£å°" message**
A: This indicates the player currently has no active ban record, possibly already unbanned or never banned.

### Configuration File Format

The correct configuration file format should be:
```hocon
defaults {
  ban_reason = "Rule violation"
  kick_reason = "Kicked by admin"
}

bans {
  "PlayerName": {
    name: "PlayerName"
    uuid: "player-uuid-here"  # Auto-filled when banning online players
    ip: "player-ip-here"      # Auto-filled when banning online players
    reason: "Ban reason"
    start_time: 1698765432
    end_time: null            # null means permanent ban
    state: true               # true means active
  }
  "OfflinePlayer": {
    name: "OfflinePlayer"
    uuid: null                # Offline ban, auto-updated on login
    ip: null                  # Offline ban, auto-updated on login
    reason: "Offline ban"
    start_time: 1698765432
    end_time: null
    state: true
  }
}
```

---

### Support & Feedback
If you encounter issues or have suggestions, please contact us via:

- **GitHub Issues**: [Submit an Issue](https://github.com/NSrank/BanTools/issues)

---

### License & Disclaimer
- **Development Notice**: This plugin is AI-developed to provide efficient ban management tools for the Minecraft Velocity community.
- **License**: Distributed under the GNU General Public License v3.0. You may use, modify, and distribute it under the license terms.
- **Disclaimer**: The developer is not responsible for any issues arising from the use of this plugin.

---

### Acknowledgments
Special thanks to the following technologies and tools:

- [Velocity API](https://papermc.io/software/velocity)
- [Typesafe Config](https://github.com/lightbend/config)
- [Adventure API](https://github.com/KyoriPowered/adventure)